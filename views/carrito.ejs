<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Carrito - MiTienda</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/home">DiegoTienda</a>

            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="/home">Inicio</a></li>
                    <li class="nav-item"><a class="nav-link" href="/productos">Productos</a></li>
                    <li class="nav-item">
                        <a class="nav-link" href="/carrito">
                            Carrito ðŸ›’ <span class="badge bg-success"><%= carrito.length %></span>
                        </a>
                    </li>
                </ul>
               
            </div>
        </div>
    </nav>

    <!-- Carrito -->
    <div class="container mt-6">
        <h2 class="mb-4 text-center">Carrito de Compras</h2>

        <% if (carrito.length === 0) { %>
            <p class="text-center">Tu carrito estÃ¡ vacÃ­o</p>
        <% } else { %>
            <ul class="list-group mb-6">
                <% carrito.forEach(item => { %>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong><%= item.nombre %></strong> - $<%= item.precio %> MXN
                        </div>
                        <form action="/eliminar" method="POST">
                            <input type="hidden" name="id" value="<%= item.id %>">
                            <button type="submit" class="btn btn-danger btn-sm">Eliminar</button>
                        </form>
                    </li>
                <% }) %>
            </ul>

            <div class="text-center mt-4">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#compraModal">
                    <i class="fas fa-credit-card me-2"></i>Pagar
                </button>
            </div>
        <% } %>
    </div>

    <!-- Modal de confirmaciÃ³n -->
    <div class="modal fade" id="compraModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body text-center p-5">

                    <!-- Estado de carga -->
                    <div id="loadingState">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                        <h5>Procesando tu compra...</h5>
                    </div>

                    <!-- Estado de Ã©xito -->
                    <div id="successState" style="display: none;">
                        <div class="mb-3">
                            <i class="fas fa-check-circle text-success" style="font-size: 3rem;"></i>
                        </div>
                        <h5 class="text-success">Â¡Compra exitosa!</h5>
                        <p>Tu pedido ha sido procesado correctamente.</p>
                        <button class="btn btn-success" data-bs-dismiss="modal">Cerrar</button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS y dependencias -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const loadingState = document.getElementById('loadingState');
        const successState = document.getElementById('successState');

        document.getElementById('compraModal').addEventListener('shown.bs.modal', function () {
            // SimulaciÃ³n de proceso de pago (2 segundos)
            setTimeout(async function () {
                loadingState.style.display = 'none';
                successState.style.display = 'block';

                // Vaciar carrito desde el servidor
                await fetch('/vaciar-carrito', { method: 'POST' });
            }, 2000);
        });

        // Cuando se cierra el modal, resetear estados y recargar la pÃ¡gina
        document.getElementById('compraModal').addEventListener('hidden.bs.modal', function () {
            loadingState.style.display = 'block';
            successState.style.display = 'none';

            // Recargar para actualizar el carrito vacÃ­o
            location.reload();
        });
    });
</script>


</body>

</html>
